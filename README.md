# Простая база данных

Консольное приложение имитирует работу с метаданными таблиц: позволяет создавать, перечислять и удалять описания структур, сохраняя их в `db_meta.json`.

## Управление таблицами

- `create_table <имя> <столбец:тип> ...` — создать таблицу (столбец `ID:int` добавляется автоматически, если он не был указан явно).
- `list_tables` — вывести имена всех сохранённых таблиц.
- `drop_table <имя>` — удалить таблицу.
- `help` — показать подсказку по доступным командам.
- `exit` — выйти из программы.

Поддерживаемые типы столбцов: `int`, `str`, `bool`. При некорректных данных приложение сообщает об ошибке и предлагает повторить ввод.

## Установка и запуск

```bash
make install           # установить зависимости и собрать виртуальное окружение
poetry run database    # запустить приложение (альтернатива: make project)
```

Пакет также можно собрать / установить локально:

```bash
make build
make package-install
```

## Пример работы

```
>>> database

***Процесс работы с таблицей***
Функции:
<command> create_table <имя_таблицы> <столбец1:тип> .. - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

>>> Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

>>> Введите команду: list_tables
- users

>>> Введите команду: drop_table users
Таблица "users" успешно удалена.

>>> Введите команду: exit
Выход из программы.
```

## CRUD-операции

- `insert into <имя> values ("текст", 123, true)` — добавить запись (ID генерируется автоматически).
- `select from <имя>` / `select from <имя> where столбец = значение` — вывести все записи или только подходящие.
- `update <имя> set столбец = значение where поле = условие` — изменить найденные записи.
- `delete from <имя> where поле = условие` — удалить записи.
- `info <имя>` — показать схему таблицы и количество записей.

Все значения приводятся к типам из схемы (`int`, `str`, `bool`). Строки указывайте в кавычках, булевы значения — `true`/`false`.

## Декораторы и улучшения

- Все операции ядра обёрнуты в `handle_db_errors(...)`, поэтому ошибки валидации и обращения к несуществующим ресурсам отлавливаются централизованно.
- Опасные действия (`drop_table`, `delete`) требуют подтверждения через `confirm_action`, что помогает избежать случайного удаления данных.
- Длительные запросы (`insert`, `select`) логируют время выполнения благодаря `log_time`.
- Повторные `select` с одинаковыми условиями обслуживает кэш из `create_cacher()`, а `insert`/`update`/`delete`/`drop_table` принудительно сбрасывают его, чтобы пользователь видел актуальные данные.

## Features (отклоенения от проекта)

- Парсер команд устойчив к сложным конструкциям: поддерживает несколько присваиваний в `SET`, вариации без пробелов (`age=29,is_active=false`) и значения с запятыми внутри кавычек.
- Утилиты чтения/записи автоматически создают каталог `data`, бсохраняют содержимое в красиво отформатированном UTF-8 виде.
- При удалении таблицы очищается и связанный JSON-файл с данными, чтобы не оставались «хвосты» в `data/`.
- Декоратор `handle_db_errors` намеренно используется как фабрика (`@handle_db_errors(...)`), чтобы можно было задавать тип или callable для дефолтного результата; вызов без скобок проектом не поддерживается.

Спорно:
- Булевы поля дополнительно принимают числовые значения `0`/`1`

## Демонстрации
### Демонстрация установки
[![asciinema installation demo](https://asciinema.org/a/xJaX1VIWkHDkpisUaaz0LW07g.svg)](https://asciinema.org/a/xJaX1VIWkHDkpisUaaz0LW07g)

### Демонстрация CRUD
[![asciinema crud demo](https://asciinema.org/a/ZENMUZpm5a8fUotJFjVtUfb1z.svg)](https://asciinema.org/a/ZENMUZpm5a8fUotJFjVtUfb1z)

### Демонстрация декораторов
_(запись финальной сессии с подтверждениями и обработкой ошибок будет добавлена позже)_


## Лицензия

Проект создан в рамках учебного задания Яндекс Практикума.
